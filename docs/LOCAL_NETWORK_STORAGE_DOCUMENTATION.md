# Локальное хранилище сетей - Документация

## Обзор

Реализована система локального хранения сетей в виде отдельных файлов `.db` с использованием словарной структуры Python. Каждая сеть сохраняется в отдельный файл `<имя_сети>.db` в директории `networks/`.

## Архитектура

### Модуль NetworkStorage

**Файл:** `src/storage/network_storage.py`

Основной класс для управления локальным хранением сетей:

```python
class NetworkStorage:
    def __init__(self, storage_dir: str = "networks")
    def save_network(self, network_name: str, network_data: Dict[str, List[str]]) -> bool
    def load_network(self, network_name: str) -> Optional[Dict[str, List[str]]]
    def delete_network(self, network_name: str) -> bool
    def list_networks(self) -> List[str]
    def network_exists(self, network_name: str) -> bool
    def get_network_info(self, network_name: str) -> Optional[Dict[str, Any]]
    def clear_all_networks(self) -> bool
    def export_network_to_text(self, network_name: str, output_file: str = None) -> bool
```

### Формат хранения

Каждый файл `<имя_сети>.db` содержит словарь Python:

```python
{
    'a': ['b', 'c'],  # узел 'a' связан с 'b' и 'c'
    'b': ['c'],       # узел 'b' связан только с 'c'
    'c': []           # узел 'c' не имеет связей
}
```

**Ключ:** имя узла сети  
**Значение:** список узлов, с которыми данный узел имеет связь

### Диалог управления

**Файл:** `src/gui/local_network_manager_dialog.py`

GUI интерфейс для управления локальными сетями:

- Просмотр списка сохраненных сетей
- Загрузка сетей из локальных файлов
- Сохранение текущей сети в локальный файл
- Удаление локальных сетей
- Экспорт сетей в текстовый формат
- Создание новых сетей

## Использование

### Базовое использование

```python
from src.storage.network_storage import NetworkStorage

# Создание экземпляра хранилища
storage = NetworkStorage("networks")

# Пример сети
network = {
    'a': ['b', 'c'],
    'b': ['c'],
    'c': []
}

# Сохранение сети
storage.save_network("example_network", network)

# Загрузка сети
loaded_network = storage.load_network("example_network")

# Список всех сетей
networks = storage.list_networks()

# Удаление сети
storage.delete_network("example_network")
```

### Интеграция с GUI

```python
from src.gui.local_network_manager_dialog import LocalNetworkManagerDialog

# Открытие диалога управления
dialog = LocalNetworkManagerDialog(parent_window)
result = dialog.show()

if result and result['action'] == 'load':
    network_name = result['network_name']
    network_data = result['network_data']
    # Использование загруженной сети
```

## Особенности реализации

### Безопасность файлов

- Автоматическая очистка имен файлов от недопустимых символов
- Замена символов `<>:"/\|?*` на подчеркивания
- Обработка пустых имен (замена на "default")

### Производительность

- Использование `pickle` для быстрой сериализации/десериализации
- Оптимизированная работа с файловой системой
- Поддержка больших сетей (протестировано на 1000+ узлах)

### Надежность

- Обработка ошибок на всех уровнях
- Логирование всех операций
- Graceful handling граничных случаев

## Тестирование

### Тестовый скрипт

**Файл:** `scripts/test_local_network_storage_fixed.py`

Включает тесты для:

1. **Базовой функциональности:**
   - Сохранение сетей
   - Загрузка сетей
   - Получение списка сетей
   - Получение информации о сетях
   - Проверка существования сетей
   - Экспорт в текст
   - Удаление сетей
   - Очистка всех сетей

2. **Граничных случаев:**
   - Пустые сети
   - Недопустимые символы в именах
   - Длинные имена
   - Пустые имена

3. **Производительности:**
   - Большие сети (1000+ узлов)
   - Измерение времени операций

### Результаты тестирования

```
Тестирование локального хранилища сетей
==================================================

Тест 1: Сохранение сетей
------------------------------
Сохранение 'simple_network': Успех
Сохранение 'complex_network': Успех
Сохранение 'ring_network': Успех

Тест 2: Список сетей
------------------------------
Найдено сетей: 3
  - complex_network
  - ring_network
  - simple_network

Тест 3: Загрузка сетей
------------------------------
Загрузка 'complex_network': Узлов: 5, Связей: 7
Загрузка 'ring_network': Узлов: 4, Связей: 4
Загрузка 'simple_network': Узлов: 3, Связей: 3

Тест производительности
------------------------------
Сохранение большой сети (1000 узлов): Успех
Время сохранения: 0.001 секунд
Загрузка большой сети: Успех
Время загрузки: 0.014 секунд
Размер файла: 69229 байт
Узлов: 1000
Связей: 4985
```

## Преимущества

1. **Простота:** Использование стандартных средств Python без внешних зависимостей
2. **Производительность:** Быстрая работа с файлами благодаря pickle
3. **Гибкость:** Легко расширяемая архитектура
4. **Надежность:** Обработка ошибок и граничных случаев
5. **Интеграция:** Полная интеграция с существующим GUI

## Ограничения

1. **Формат:** Только словарный формат Python (не JSON, не XML)
2. **Совместимость:** Файлы не совместимы с другими системами
3. **Размер:** Ограничен размером файловой системы
4. **Конкурентность:** Нет поддержки одновременного доступа

## Будущие улучшения

1. **Сжатие:** Добавление сжатия для больших файлов
2. **Индексация:** Создание индексов для быстрого поиска
3. **Версионирование:** Поддержка версий сетей
4. **Синхронизация:** Синхронизация между устройствами
5. **Шифрование:** Шифрование конфиденциальных данных

## Заключение

Система локального хранилища сетей успешно реализована и протестирована. Она обеспечивает:

- Надежное хранение сетей в словарном формате
- Высокую производительность (1000+ узлов за миллисекунды)
- Полную интеграцию с GUI
- Обработку граничных случаев
- Подробное логирование операций

Система готова к использованию в производственной среде.
